<!DOCTYPE html>
<html>

<head>
	<meta name="viewport" content="width=device-width,initial-scale=1.0">
	<title>Socket.IO chat</title>
	<style>
		body {
			margin: 0;
			padding: 0;
			/* overflow: hidden; */
			overflow-y: auto;
			/* Enable scrolling */
			font-family: -apple-system, BlinkMacSystemFont, "Avenir", Roboto, Helvetica, Arial, sans-serif;
			background-color: #E5F4E1;
		}

		#form {
			background: rgba(255, 255, 255, 0);
			margin-right: 0.5rem;
			padding: 0.25rem;
			padding-top: 0rem;
			display: flex;
			position: fixed;
			bottom: 0;
			left: 0;
			right: 0;
			height: 3rem;
			box-sizing: border-box;
		}

		#messagesContainer {
			border: 2px solid #E5EDFF;
			/* Border color */
			border-radius: 8px;
			/* Rounded corners */
			padding: 0.5rem;
			/* Space between border and messages */
			margin: 1rem;
			/* Space around the container */
			height: 10rem;
			overflow-y: auto;
			/* Enable scrolling */
			background-color: #fff;
			/* Background color */
			box-shadow: 0px 4px 10px rgba(0, 0, 0, 0.1);
			/* Shadow for depth */
		}

		.sendButton {
			background-color: #00C200;
			color: white;
			border: none;
			margin: 20px;
			margin-top: 0;
			padding: 8px 12px;
			font-size: 16px;
			border-radius: 5px;
			cursor: pointer;
			box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
			transition: background-color 0.3s ease;
		}

		.sendButton:hover {
			background-color: #28A428;
		}

		#messages {
			list-style-type: none;
			margin: 0;
			padding-left: 0.5rem;
			padding-right: 0.5rem;
			max-height: 10rem;
			height: 10rem;
			/* Set a height for the chat area */
			overflow-y: auto;
			/* Enable scrolling */
		}

		.message-container.user-message {
			justify-content: flex-start;
			/* Align user messages to the right */
			column-gap: 0.5rem;
		}

		.avatar {
			width: 36px;
			height: 36px;
			border-radius: 50%;
			/* Make the image circular */
			background-color: #d9d9d9;
			display: flex;
			/* To center the image */
			justify-content: center;
			/* Centering */
			align-items: center;
			/* Centering */
			padding: 0.5rem;
		}

		.user-message .avatar {
			margin-right: 0;
			margin: 1rem 0;
			/* Adjust margin for user messages */
		}

		#messages>li {
			display: inline-block;
			max-width: 80%;
			/* Limit width of chat bubbles */
			width: fit-content;
			/* Adjusts width based on message length */
			padding: 0.75rem 1rem;
			margin: 0;
			border-radius: 15px;
			background-color: #E5EDFF;
			color: #000000;
			overflow-wrap: break-word;
			/* Allow long messages to wrap */
			white-space: pre-wrap;
			/* Preserve whitespace and wrap text */
			box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.1);
		}

		.message-container {
			display: flex;
			align-items: center;
			margin: 0rem 0;
		}

		.message-text {
			display: block;
			max-width: 80%;
			/* Limit width of chat bubbles */
			width: fit-content;
			/* Adjusts width based on message length */
			padding: 0.75rem 1rem;
			margin: 1rem 0;
			border-radius: 15px;
			background-color: #E5EDFF;
			color: #000000;
			overflow-wrap: break-word;
			/* Allow long messages to wrap */
			white-space: pre-wrap;
			/* Preserve whitespace and wrap text */
			box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.1);
			animation: popIn 0.4s ease forwards;
		}

		.scrollable-container {
			max-height: 330px;
			overflow-y: auto;
			border: 1px solid #ccc;
			padding: 10px;
			margin: 0 auto;
		}

		.topic {
			font-size: 20px;
			margin-left: 20px;
			margin-top: 10px;
			margin-bottom: 10px;
			font-family: "Avenir";
		}

		.note-label {
			margin-left: 20px;
			margin-bottom: 10px;
			padding-top: 20px;
			font-style: italic;
			font-family: "Avenir";
		}

		.font {
			font-family: "Avenir";
		}

		#toolbar {
			display: flex;
			gap: 5px;
			margin: 20px;
			margin-top: 10px;
		}

		#toolbar button {
			margin: 0;
			padding: 5px;
		}

		#userInput {
			margin-top: 5px;
			margin: 20px;
			margin-bottom: 10px;
			height: calc(100vh - 300px);
			border: 2px solid #ccc;
			padding: 10px;
			overflow-y: auto;
			white-space: pre-wrap;
			background-color: #ffffff;
		}

		#userInput:focus {
			border: 2px solid #000;
		}

		.other-message {
			background-color: #f1f0f0;
			color: #333;
			text-align: left;
		}

		@keyframes popIn {
			0% {
				transform: scale(0.8);
				opacity: 0;
			}

			70% {
				transform: scale(1.3);
				opacity: 1;
			}

			100% {
				transform: scale(1);
				opacity: 1;
			}
		}
	</style>
	<script defer>
		function formatText(command) {
			document.execCommand(command, false, null);
		}

		function changeFont(fontName) {
			setTimeout(() => {
				document.execCommand("fontName", false, fontName);
			}, 0);
		}

		function changeFontSize(size) {
			document.execCommand("fontSize", false, "7");
			const spans = document.querySelectorAll("#userInput font[size='7']");
			spans.forEach(span => {
				span.removeAttribute("size");
				span.style.fontSize = size;
			});
		}

		function addBullet() {
			document.execCommand("insertUnorderedList", false, null);
		}

		function addNumberedList() {
			document.execCommand("insertOrderedList", false, null);
		}

		function sanitizeInput(input) {
			const div = document.createElement('div');
			div.innerHTML = input;
			return div.textContent || div.innerText || '';
		}

		function sendNote() {
			const userInputDiv = document.getElementById("userInput");
			const userInput = sanitizeInput(userInputDiv.innerHTML);
			const errorDiv = document.getElementById("error-message"); // Error message container
			console.log("User Input:", userInput);

			if (userInput.length < 50) {
				// Show error message if input is below 50 characters
				errorDiv.innerText = "Input must be at least 50 characters.";
				errorDiv.style.display = "block";
				return; // Prevent form submission
			} else {
				errorDiv.style.display = "none"; // Hide error message if valid
			}

			// Temporarily save the content to LocalStorage
			localStorage.setItem("userInput", userInput);

			fetch('/save-data2', {
				method: 'POST',
				headers: { 'Content-Type': 'application/json' },
				body: JSON.stringify({
					sessionId: localStorage.getItem("sessionId"),
					full_notes: userInput
				})
			})
			.then(response => {
				if (response.ok) {
					alert("Data saved successfully");
					// window.location.href = "?mode=task1_prompt"; // Redirect if needed
				} else {
					console.error("Failed to save data");
				}
			})
			.catch(error => console.error("Error:", error));

		}
	</script>
</head>

<body>
	<!-- Instruction text div -->
	<div id="instruction" class="topic">
		<strong>Topic:</strong> How are advances AI impacting education?
	</div>
	<div>
		<label for="userInput" class="note-label">Write your notes here</label>
		<div id="toolbar">
			<select id="fontSelect" class="font" onchange="changeFont(this.value)">
				<option value="Arial">Arial</option>
				<option value="Calibri">Calibri</option>
				<option value="Georgia">Georgia</option>
				<option value="Times New Roman">Times New Roman</option>
				<option value="Verdana">Verdana</option>
			</select>
			<button onclick="formatText('bold')"><b>B</b></button>
			<button onclick="formatText('italic')"><i>I</i></button>
			<button onclick="formatText('underline')"><u>U</u></button>
			<select id="fontSizeSelect" onchange="changeFontSize(this.value)">
				<option value="">16</option>
				<option value="8px">8</option>
				<option value="9px">9</option>
				<option value="10px">10</option>
				<option value="11px">11</option>
				<option value="12px">12</option>
				<option value="14px">14</option>
				<option value="16px">16</option>
				<option value="18px">18</option>
				<option value="24px">24</option>
				<option value="30px">30</option>
				<option value="36px">36</option>
				<option value="48px">48</option>
				<option value="60px">60</option>
				<option value="72px">72</option>
				<option value="96px">96</option>
			</select>
			<button onclick="addBullet()">â€¢</button>
			<button onclick="addNumberedList()">123</button>
		</div>
		<div id="userInput" contenteditable="true" style="border: 1.5px solid #aaa; padding: 0.5rem;"></div>
		<div id="error-message" style="color: red; display: none; margin: 5px 20px;"></div>
		<div style="text-align: right;">
			<button type="button" class="sendButton" onclick="sendNote()">Submit</button>
		</div>
	</div>
	<script src="/socket.io/socket.io.js"></script>
	<script>
		const socket = io();
		const form = document.getElementById('form');
		const input = document.getElementById('input');
		const messages = document.getElementById('messages');

		form.addEventListener('submit', (e) => {
			e.preventDefault();
			if (input.value) {
				socket.emit('chat message', input.value, true);
				input.value = '';
			}
		});
		socket.on('chat message', (msg, n) => {
			const messageContainer = document.createElement('div');
			messageContainer.className = 'message-container';
			messageContainer.classList.add('user-message');

			const avatar = document.createElement('img');
			if (n === 1) {
				avatar.src = '/images/critical_thinking.png'
			} else if (n === 2) {
				avatar.src = '/images/planning.png'
			} else {
				avatar.src = '/images/key_takeaways.png'
			}

			avatar.className = 'avatar';

			// Chat message bubble
			const messageBubble = document.createElement('li');
			messageBubble.innerHTML = msg.text;
			messageBubble.className = 'message-text';
			messageContainer.appendChild(avatar);
			messageContainer.appendChild(messageBubble);

			// Append container to messages list
			messages.appendChild(messageContainer);
			messages.scrollTop = messages.scrollHeight;
		});
	</script>
</body>

</html>